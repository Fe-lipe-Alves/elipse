(()=>{var e=null,t=function(e){var t=new Date(e),s=t.getDate().toString(),n=1===s.length?"0"+s:s,a=(t.getMonth()+1).toString();return n+"/"+(1===a.length?"0"+a:a)+"/"+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()},s=function(e){var s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=$("#receiver_id").val(),a=e.sender_id!==parseInt(n),i="",o=t(e.created_at);if(e.file)if(null!==e.files){var l=["PNG","JPG","JPEG","GIF"];i=l.indexOf(e.files.type.toUpperCase())>-1?'<a href="'+e.files.source+'" target="_blank"><img src="'+e.files.source+'" class="max-w-full" title="'+e.files.name+'" alt="'+e.files.name+'"/></a>':'<a href="'+e.files.source+'"><span>'+e.files.name+"</span></a>"}else i='<p><small class="text-sm text-red-300">Erro ao obter arquivo.</small></p>';else i='<p class="text-sm">'+e.content+"</p>\n";var r='<div class="w-full flex flex-col '+(a?"items-end":"")+'">\n<div class="w-8/12 px-4 py-2 ml-1 mr-2  rounded-lg shadow hover:shadow-md outline-none focus:outline-none ease-linear transition-all duration-150 '+(a?"bg-white":"bg-primary-500-light")+(0===e.sender_id?" mt-1":"mt-3")+'">\n'+i+'<small class="text-xxs '+(a?"float-right":"")+'">'+o+"</small>\n</div>\n</div>";s?$("#history").append(r):$("#history").prepend(r)};receiverListItemClick=function(){$(this).data("active")||(e=$(this).data("id"),$(".receiver-list-item").each((function(e,t){$(t).removeClass("bg-primary-500-light shadow-md").addClass("hover:bg-white").data("active",!1)})),$(this).addClass("bg-primary-500-light shadow-md").removeClass("hover:bg-white").data("active",!0),$("#receiver_id").val($(this).data("id")),$("#history").html(""),showLoadingHistory(),$.get($(this).data("route")).then((function(e){e.success&&(e.messages.forEach((function(e){s(e)})),showHistory())})))},showHistory=function(){$("#newMessage, #history").removeClass("hidden"),$("#emptyHistory, #loadingHistory").addClass("hidden")},showLoadingHistory=function(){$("#newMessage, #history, #emptyHistory").addClass("hidden"),$("#loadingHistory").removeClass("hidden")},checkContent=function(){return""!==$("#text-new-message").val()||$("#files")[0].files.length>0},checkContentSend=function(){checkContent()?$("#btn-send").removeClass("bg-white").addClass("bg-primary-500").prop("disabled",!1):$("#btn-send").addClass("bg-white").removeClass("bg-primary-500").prop("disabled",!0)},changeBoxInputFile=function(){var e=$("#box-files-name"),t=$("#box-input-text"),s=$("#files"),n=s[0].files.length;if($("#text-new-message").val(""),n>0){var a=[];$(s[0].files).each((function(e,t){a.push(t.name)})),a=a.join(", "),t.addClass("hidden"),e.removeClass("hidden"),e.find("#length").text(n),e.find("#files-name").html(a).attr("title",a)}else t.removeClass("hidden"),e.addClass("hidden")},sendMessage=function(){var e=$("#newMessage"),t=new FormData(e[0]);$("#text-new-message").val(""),$("#files").val("").change(),$.ajax({url:e.attr("action"),type:"post",data:t,async:!1,cache:!1,contentType:!1,enctype:"multipart/form-data",processData:!1,dataType:"json",success:function(e){e.success&&(e.messages.forEach((function(e){s(e,!0)})),showHistory())}})},loadMessage=function(t){console.log(t),null!==e&&t.sender_id===e?s(t,!0):$(".receiver-list-item").each((function(e,s){if($(s).data("id")===t.sender_id){var n,a=$(s).find(".qtNew"),i=(null!==(n=parseInt(a.data("quantity")))&&void 0!==n?n:0)+1;a.text(i+" "+(i>1?"novas":"nova")),a.data("quantity",i)}}))},window.addListenersMessage(loadMessage),$(document).ready((function(){$(".receiver-list-item").on("click",receiverListItemClick),$("#text-new-message").on("keyup",(function(){checkContentSend()})),$("#btn-file").on("click",(function(){$("#files").click()})),$("#files").on("change",(function(){changeBoxInputFile(),checkContentSend()})),$("#newMessage").on("submit",(function(e){e.preventDefault(),sendMessage()}))}))})();